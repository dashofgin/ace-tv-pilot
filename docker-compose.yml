services:
  acestream:
    image: jopsis/aceserve:latest
    container_name: acestream-engine
    ports:
      - "6878:6878"
      - "62062:62062"
    volumes:
      - acestream-cache:/root/.ACEStream
    dns:
      - 1.1.1.1
      - 1.0.0.1
    restart: unless-stopped
    tmpfs:
      - /tmp

  httpaceproxy:
    image: jopsis/httpaceproxy:latest
    container_name: httpaceproxy
    ports:
      - "8888:8888"
    environment:
      - ACESTREAM_HOST=acestream
      - ACESTREAM_API_PORT=62062
      - ACESTREAM_HTTP_PORT=6878
      - MAX_CONNECTIONS=10
      - MAX_CONCURRENT_CHANNELS=5
    depends_on:
      - acestream
    restart: unless-stopped

  backend:
    build: ./backend
    container_name: ace-tv-backend
    devices:
      - /dev/dri:/dev/dri
    environment:
      - ACESTREAM_URL=http://acestream:6878
      - AUTH_USERNAME=${AUTH_USERNAME:-admin}
      - AUTH_PASSWORD=${AUTH_PASSWORD:-changeme}
      - SESSION_SECRET=${SESSION_SECRET:-change-this-secret}
      - EPG_URL=https://epg.ovh/pl.xml
      - TZ=Europe/Warsaw
    volumes:
      - ./data:/app/data
    depends_on:
      - acestream
    restart: unless-stopped

  nginx:
    image: nginx:alpine
    container_name: ace-tv-nginx
    ports:
      - "3000:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./frontend/dist:/usr/share/nginx/html:ro
    depends_on:
      - backend
      - acestream
    restart: unless-stopped

volumes:
  acestream-cache:
